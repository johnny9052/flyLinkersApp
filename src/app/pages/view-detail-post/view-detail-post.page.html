<app-header></app-header>

<ion-content style="width: 100%; margin: 0px !important;">
  <ion-card>

    <!--INFORMACION DEL AUTOR DE LA PUBLICACION-->
    <ion-item>
      <ion-avatar slot="start" (click)="viewProfile(post.author_id)">
        <img src="https://flylinkers.com/media/{{(post.author_image_perfil !== '' )? post.author_image_perfil: 'avatar_2x.png' }}">
      </ion-avatar>

      <ion-label (click)="viewProfile(post.author_id)">
        <h3 slot="start">
          {{post.author_fistName}} {{post.author_lastName}}
        </h3>

        <p>{{post.author_profession}}</p>
      </ion-label>

      <ion-icon
        slot="end"
        name="more"
        (click)="presentActionSheet(post.id_new)"
        *ngIf="post.author_id === codeUser"
      ></ion-icon>
    </ion-item>
    <!--END INFORMACION DEL AUTOR DE LA PUBLICACION-->

    <!--INFORMACION DE LA PUBLICACION-->
    <ion-item
      lines="none"
      *ngIf="post.title !== null"
    >
      <h5 slot="start">{{ post.title }}</h5>
    </ion-item>

    <ion-card-content *ngIf="post.content !== null">{{post.content}}</ion-card-content>

    <ion-item
      lines="none"
      *ngIf="post.image_new !== ''"
    >
      <ion-img src="https://flylinkers.com/media/{{post.image_new}}"></ion-img>
    </ion-item>

    <ion-item
      lines="none"
      *ngIf="((post.metadataImage !== '/' || post.metadataImage !== '/') && post.image_new === '') && post.external_url_new !=='' "
    >
      <ion-img
        [src]="post.metadataImage"
        style="width: 350px; height: auto;"
      ></ion-img>
    </ion-item>

    <ion-item
      lines="none"
      *ngIf="post.metadataTitle && post.external_url_new !==''"
    >
      <p>{{post.metadataTitle}}</p>
    </ion-item>

    <ion-item
      lines="none"
      *ngIf="post.metadataDescription && post.external_url_new !==''"
    >
      <p>{{post.metadataDescription}}</p>
    </ion-item>

    <ion-item lines="none">
      <ion-label slot="start">
        <h3>
          <br>
          {{post.publication_date | date: 'dd/MM/yyyy'}}
        </h3>
      </ion-label>
    </ion-item>

    <!--END INFORMACION DE LA PUBLICACION-->

    <ion-row>
      <!--DAR LIKE A LA PUBLICACION-->
      <ion-col>
        <ion-item *ngIf="!post.liked_by_user">
          <ion-icon name="heart-empty" (click)="generarLikePost(post.id_new)"></ion-icon>
          <div *ngIf="post.likes > 0"> {{post.likes}}</div>
        </ion-item>
        <ion-item *ngIf="post.liked_by_user">
          <ion-icon name="heart" (click)="generarLikePost(post.id_new)"></ion-icon>
          <div *ngIf="post.likes > 0"> {{post.likes}}</div>
        </ion-item>
      </ion-col>
      <!--END DAR LIKE A LA PUBLICACION-->

      <!--ICONO DE COMENTARIOS DE LA PUBLICACION-->
      <ion-col>
        <ion-item>
          <ion-icon name="text" (click)="showHideComments()"></ion-icon>
          <div *ngIf="post.count_comments > 0"> {{post.count_comments}}</div>
        </ion-item>
      </ion-col>
      <!--END ICONO DE COMENTARIOS DE LA PUBLICACION-->

      <!--ICONO DE COMPARTIR LA PUBLICACION-->
      <ion-col>
        <ion-item>
          <ion-icon name="share" (click)="sharedPost(post.content,post.external_url_new,post.image_new,post.title)"></ion-icon>
        </ion-item>
      </ion-col>
      <!--END ICONO DE COMPARTIR LA PUBLICACION-->
    </ion-row>

    <form
        #formulario="ngForm"
        (ngSubmit)="saveComment(post.id_new)"
    >
      <ion-list
          style="width: 100%; margin: 0px !important; border-radius: 0px; padding: 0px;"
      >

        <!--ESCRIBIR COMENTARIO PRINCIPAL-->
        <ion-item
          color="FlyLinkers-Blanco"
          [hidden]="hiddenComments"
        >
          <ion-label position="floating">{{ 'escribeComentario' | translate }}</ion-label>
          <ion-textarea type="text" name="comment" required = "required" [(ngModel)]="comment.comment"></ion-textarea>
          <ion-button
            color="flylinkers"
            type="submit"
            [disabled]="formulario.invalid"
            fill="outline"
            slot="end"
          >{{ 'enviar' | translate }}</ion-button>
        </ion-item>
        <!--END ESCRIBIR COMENTARIO PRINCIPAL-->

        <!--LISTADO DE TODOS LOS COMENTARIOS DE LA PUBLICACION-->
        <ion-item-group *ngFor="let comment of comments">

          <!--INFORMACION BASICA DE LAS PERSONAS QUE REALIZAN UN COMENTARIO-->
          <ion-item lines="none">
            <ion-avatar slot="start" (click)="viewProfile(comment.id_author)">
             <img src="https://flylinkers.com/media/{{(comment.comment_author_image !== '' )? comment.comment_author_image: 'avatar_2x.png' }}">
            </ion-avatar>
            <ion-label (click)="viewProfile(comment.id_author)">
              <h3>{{comment.comment_firstname_author}} {{comment.comment_lastname_author}}</h3>
            </ion-label>
            <ion-icon slot= "end" name="more" (click)="mostrarPop($event, comment.id_comment, comment.comment,post.id_new)" *ngIf="codeUser === comment.id_author"></ion-icon>
          </ion-item>
          <!--END INFORMACION BASICA DE LAS PERSONAS QUE REALIZAN UN COMENTARIO-->

          <!-- COMENTARIO REALIZADO -->
          <ion-item lines="none">
            <p>{{ comment.comment }}</p>
          </ion-item>
          <!-- END COMENTARIO REALIZADO -->

          <!--BOTONERA DE OPCIONES DE CADA COMENTARIO REALIZADO-->
          <ion-item slot = "start">
            <ion-row>
              <!--BOTON DE LIKES DE CADA COMENTARIO REALIZADO-->
              <ion-col>
                <!--ICONO DE LIKE CUANDO EL USUARIO NO HA DADO LIKE-->
                <ion-item lines="none" *ngIf="!comment.like_by_user">
                  <ion-icon name="heart-empty" (click)="generarLikeComment(comment.id_comment)"></ion-icon>
                  <div *ngIf="comment.likes > 0"> {{comment.likes}}</div>
                </ion-item>
                <!--END ICONO DE LIKE CUANDO EL USUARIO NO HA DADO LIKE-->

                <!--ICONO DE LIKE CUANDO EL USUARIO HA DADO LIKE-->
                <ion-item lines="none" *ngIf="comment.like_by_user">
                  <ion-icon name="heart" (click)="generarLikeComment(comment.id_comment)"></ion-icon>
                  <div *ngIf="comment.likes > 0"> {{comment.likes}}</div>
                </ion-item>
                <!--END ICONO DE LIKE CUANDO EL USUARIO HA DADO LIKE-->
              </ion-col>
              <!--END BOTON DE LIKES DE CADA COMENTARIO REALIZADO-->

              <!--ICONO PARA HACER UN RECOMENTARIO-->
              <ion-col>
                <ion-item lines="none">
                  <ion-icon name="text" (click)="getRecomments(comment.id_comment, post.id_new)"></ion-icon>
                  <div *ngIf="comment.count_recomments > 0"> {{comment.count_recomments}}</div>
                </ion-item>
              </ion-col>
              <!--END ICONO PARA HACER UN RECOMENTARIO-->

            </ion-row>
          </ion-item>
          <!--END BOTONERA DE OPCIONES DE CADA COMENTARIO REALIZADO-->


          <!--****************************SECCION DE RECOMENTARIOS**********************************************************-->
          <ion-item [hidden]="comment.hiddenRecomments" [id]=comment.id_comment>
              <form
              #formulario="ngForm"
              (ngSubmit)="saveRecomment(comment.id_comment, post.id_new)"
          >
            <ion-list
                [hidden]="comment.hiddenRecomments"
                style="width: 100%; margin: 0px !important; border-radius: 0px; padding: 0px;"
            >
              <ion-item
                color="FlyLinkers-Blanco"
              >
                <ion-label position="floating">{{ 'escribeComentario' | translate }}</ion-label>
                <ion-textarea type="text" name="comment" [(ngModel)]="recomment.comment" required = "required"></ion-textarea>
                <ion-button
                  color="flylinkers"
                  type="submit"
                  [disabled]="formulario.invalid"
                  fill="outline"
                  slot="end"
                >{{ 'enviar' | translate }}</ion-button>
              </ion-item>
              <ion-item-group *ngFor="let recomment of recomments">
                <ion-item>
                  <ion-avatar slot="start" (click)="viewProfile(recomment.recomment_id_author)">
                  <img src="https://flylinkers.com/media/{{(recomment.recomment_author_image !== '' )? recomment.recomment_author_image: 'avatar_2x.png' }}">
                  </ion-avatar>
                  <ion-label (click)="viewProfile(recomment.recomment_id_author)">
                    <h3>{{recomment.recomment_firstname_author}} {{recomment.recomment_lastname_author}}</h3>
                  </ion-label>
                  <ion-icon
                    slot="end"
                    name="more"
                    (click)="mostrarPopRecomment($event, recomment.recomment_id, recomment.recomment ,post.id_new, recomment.comment_id)"
                    *ngIf="recomment.recomment_id_author === codeUser"
                  ></ion-icon>
                </ion-item>
                <ion-item>
                  <p>{{recomment.recomment}}</p>
                </ion-item>
                <!-- <ion-item slot = "start" *ngIf="!post.liked_by_user">
                  <ion-row>
                    <ion-col>
                      <ion-item lines="none">
                        <ion-icon name="heart-empty"></ion-icon>
                        <div *ngIf="post.likes > 0"> {{post.likes}}</div>
                      </ion-item>
                    </ion-col>
                    <ion-col>
                      <ion-item lines="none">
                        <ion-icon name="text" (click)="showHideComments()"></ion-icon>
                        <div *ngIf="post.count_comments > 0"> {{post.count_comments}}</div>
                      </ion-item>
                    </ion-col>
                  </ion-row>
                </ion-item>           -->
              </ion-item-group>
            </ion-list>
          </form>
          </ion-item>          
        </ion-item-group>




      </ion-list>
    </form>
  </ion-card>
</ion-content>

<app-tab
  homeColor="flylinkersBlanco"
  networkColor="flylinkersBlanco"
  notificationsColor="flylinkersBlanco"
  messagesColor="flylinkersBlanco"
  newPostColor="flylinkersGrisOscuro"
></app-tab>